# DNS：域名系统

> 域名系统（`DNS`）是一种用于`TCP/IP`应用程序的分布式数据库，它提供主机名字和`IP`地址之间的转换及有关电子邮件的选路信息。这里提到的分布式是指在`Internet`上的单个站点不能拥有所有的信息。

从应用的角度来看，对`DNS`的访问是 通过一个地址解析器（`resolver`）来完成的，在`Unix`主机中，该解析器通过两个库函数`gethostbyname(3)`和`gethostbyaddress(3)`来完成访问，解析器通过一个或多个名字服务器来完成这种相互转换。 

`DNS`的名字空间和`Unix`的文件系统相似，也具有层次结构。每个结点有一个至多`63`个字符长的标识，这颗树的树根是没有任何标识的特殊结点。以点"."结尾的域名称为绝对域名或完全合格的域名`FQDN（Full Qualified Domain Name）`，例如`sun.tuc.noao.edu`。

![dns-header-data](./reference-media/dns-header-data.png)	

`DNS`定义一个用于查询和响应的报文格式，这个报文由`12`字节长的首部和`4`个长度可变的字段组成。

从最左边开始依次介绍各字段：

`QR`是`1 bit`字段：`0`表示查询报文，`1`表示响应报文；

`opcode`是一个`4 bit	`字段，通常值为`0`（标准查询），其它值为`1	`（反向查询）和`2	`（服务器状态请求）；

`AA`是`1 bit`标志，表示授权回答`(authoritative answer)`，该名字服务器是授权于该域的；

`TC`是`1 bit`标志，表示可截断`（truncated）`，使用`UDP`时，它表示当应答的总长度超过`512`字节时，只返回前`512	`字节；

`RD`是`1 bit`字段表示“期望递归`（recursion desired）`”，该比特能在一个查询中设置，并在响应中返回；

**高速缓存**，为了减少`Internet`上`DNS`的通信量，所有的名字服务器均使用高速缓存。在标准的`Unix`实现中，高速缓存是由名字服务器而不是由名字解析器维护的。在默认情况下，名字解析器在本地主机，`UDP`端口号为`53`或`TCP`端口号为`53`，寻找名字服务器。

```
madong@spotify-mac tcpip-illustrated-network % cat /etc/resolv.conf 
#
# macOS Notice
#
# This file is not consulted for DNS hostname resolution, address
# resolution, or the DNS query routing mechanism used by most
# processes on this system.
#
# To view the DNS configuration used by this system, use:
#   scutil --dns
#
# SEE ALSO
#   dns-sd(1), scutil(8)
#
# This file is automatically generated.
#
nameserver 240e:40:8000::10
nameserver 240e:40:8000::11
```

当名字服务器发出一个虚拟请求，并且返回响应中的`TC`（删减标志）比特被设置为`1`时，它就意味着响应的长度超过了`512`个字节，而仅仅返回前`512`个字节。



## TFTP：简单文件传送协议

`TFTP（Trivial File Transfer Protocol）`即简单文件传送协议，最初打算用于引导无盘系统（通常是工作站或`X`终端）。为了保持简单和短小，`TFTP`将使用`UDP`，`TFTP`的实现（和它所需要的`UDP`、`IP`和设备驱动程序）可以被放入只读存储器中。

之前有介绍一个无盘系统，它在不知道自身`IP`地址的情况下，在进行系统引导时能够通过`RARP`来获取它的`ip`地址。然而使用`RARP`有两个问题：1）`IP`地址是返回的唯一地址；2）既然`RARP`使用链路层广播，`RARP`请求就不会被路由器转发（迫使每个物理网络设置一个`RARP`服务器），使用无盘系统进行引导的程序协议，及`BOOTP`。

